# The Frustrating Registration Form
## プロジェクト進捗報告

---

## 1. プロジェクト概要（1分）

### コンセプト
**「ユーザーの忍耐力を極限まで試すジョークWebアプリ」**

ディズニーランド級の待機列を乗り越え、様々な理不尽なタスクをクリアしても、
**最後は必ずサーバーエラーで登録できない**という鬼畜仕様。

### ユーザーフロー
```
┌─────────┐    ┌──────────┐    ┌─────────────────────┐    ┌──────────┐
│ 待機列   │ → │ Dino Run │ → │ 登録ダッシュボード    │ → │ 登録失敗  │
│(WebSocket)│    │ (ゲーム)  │    │ (9つの理不尽タスク)  │    │ (鬼畜)   │
└─────────┘    └──────────┘    └─────────────────────┘    └──────────┘
```

### 9つの登録タスク
| タスク | 入力方法 | 状態 |
|--------|----------|------|
| 名前 | スロットマシン | 未実装 |
| 生年月日 | 横スクロールバー | 未実装 |
| 電話番号 | 黒電話ダイヤル | 未実装 |
| 住所 | ストリートビュー風 | 未実装 |
| メール | 瞬きモールス信号 | 未実装 |
| 利用規約 | 音声認識読み上げ | 未実装 |
| パスワード | AI煽り付き | 実装中 |
| **CAPTCHA** | **ウォーリーを探せ風** | **✅ 完了** |
| OTP | 魚の名前当て | 実装中 |

---

## 2. 技術スタック（30秒）

### バックエンド
- **言語**: Go + Echo v4
- **通信**: gorilla/websocket
- **AI**: AWS Bedrock (Claude 3 Haiku)
- **画像処理**: Go標準ライブラリ

### インフラ（AWS）
```
CloudFront → ALB → ECS Fargate (Single Task)
     │                    │
     ↓                    ↓
  S3 (静的)          Bedrock + S3
```

### コスト
- **予算**: $100（AWSクレジット）
- **想定**: $5〜10（4日間）

---

## 3. 実装済み機能（1.5分）

### ✅ インフラ基盤
- VPC / Subnet / Security Group
- ALB（WebSocket対応、Idle Timeout 300秒）
- ECS Fargate（Single Task）
- S3（画像アセット）
- CloudFront（CDN）
- CI/CD（GitHub Actions → ECR → ECS）

### ✅ 待機列システム
- WebSocket接続管理
- リアルタイム順番通知
- 焦らし時間（10〜30秒ランダム）

### ✅ Dino Run連携
- ゲーム結果API
- 成功時: 登録ダッシュボードへ
- 失敗時: 待機列の最後尾へリセット

### ✅ CAPTCHA（ウォーリーを探せ風）
**本日完成した機能！**

```
┌────────────────────────────────────┐
│  この画像を探してクリック！ → [🦔]  │
│                                    │
│  ┌──────────────────────────────┐  │
│  │ 🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔  │  │
│  │ 🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔  │  │
│  │ 🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔  │  │
│  │ 🦔🦔🦔🦔🦔[TARGET]🦔🦔🦔🦔🦔🦔  │  │
│  │ 🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔🦔  │  │
│  └──────────────────────────────┘  │
└────────────────────────────────────┘
```

**仕様**:
- 背景: 2816 x 1536 px
- キャラクター: 4種類（ハリネズミ）
- 配置: ターゲット1枚 + ダミー90枚（各30枚×3種）
- 重なり: 衝突検出で回避
- 失敗ペナルティ: 3回失敗で待機列の最後尾へ

---

## 4. デモ（1分）

### CAPTCHA テスト画面
http://localhost:8080/captcha-test.html

**デモ手順**:
1. 「Create Session」をクリック
2. 「Generate CAPTCHA」をクリック
3. ターゲット画像が左上に表示される
4. 91体のキャラクターから正解を探してクリック
5. 正解/不正解の判定

### API レスポンス例
```json
{
  "error": false,
  "image_url": "http://localhost:8080/images/captcha/xxx.png",
  "target_image_url": "http://localhost:8080/images/character/char2.png"
}
```

---

## 5. 今後の予定（1分）

### 優先度: 高
| タスク | 内容 | 担当 |
|--------|------|------|
| パスワード煽り | Bedrock連携、リアルタイム煽りメッセージ | バックエンド |
| 魚OTP | 魚画像表示、名前判定API | バックエンド |
| フロント連携 | CAPTCHA UIの本番実装 | フロントエンド |

### 優先度: 中
| タスク | 内容 |
|--------|------|
| 登録API | 最終的に必ず失敗するAPI |
| タイムアウト処理 | 10分でトークン失効 |

### 優先度: 低（時間があれば）
| タスク | 内容 |
|--------|------|
| スロット入力 | 名前入力UI |
| 黒電話ダイヤル | 電話番号入力UI |
| その他6タスク | フロント側で実装 |

---

## 6. 課題・リスク

### 技術的課題
| 課題 | 対策 |
|------|------|
| CAPTCHA生成が遅い（約16秒） | 許容範囲内と判断（事前生成は見送り） |
| WebSocket切断時の復帰 | 仕様通り復帰不可（最後尾へ） |

### スケジュールリスク
| リスク | 対策 |
|--------|------|
| 9タスク全実装は困難 | CAPTCHA + OTP + パスワードの3つを優先 |
| フロント連携の時間 | API仕様を先に共有 |

---

## まとめ

### 完了したこと
- ✅ インフラ構築（AWS）
- ✅ CI/CDパイプライン
- ✅ 待機列システム
- ✅ Dino Run連携
- ✅ **CAPTCHA（ウォーリーを探せ風）**

### 本日のハイライト
**91体のキャラクターから1体のターゲットを探すCAPTCHAを実装！**
- 衝突検出による配置
- ターゲット画像の表示
- 3回失敗でペナルティ

### 次のマイルストーン
- パスワード煽り（Bedrock連携）
- 魚OTP
- フロントエンド連携

---

## 補足資料

### ディレクトリ構成
```
back/
├── cmd/
│   ├── server/          # 本番サーバー
│   └── captcha-test/    # CAPTCHAテストサーバー
├── internal/
│   ├── handler/         # HTTPハンドラ
│   ├── websocket/       # WebSocket管理
│   ├── captcha/         # CAPTCHA生成ロジック
│   ├── queue/           # 待機列管理
│   └── ...
└── mock-frontend/       # テスト用フロント
```

### GitHub リポジトリ
https://github.com/kyiku/hackz-ptera-back

### 最新コミット
```
2c99a06 feat: implement Where's Waldo style CAPTCHA with target display
```
